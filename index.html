<!DOCTYPE html>
<html>
<head>
<title>Iron Man HUD Scanner</title>
<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
}
#hudCanvas {
  position: absolute;
  top: 0;
  left: 0;
}
video {
  position: absolute;
  top: 0;
  left: 0;
  transform: scaleX(-1); /* Mirror effect */
}
.mode-btn {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.5);
  color: white;
  cursor: pointer;
}
</style>
</head>
<body>
<video id="video" autoplay playsinline></video>
<canvas id="hudCanvas"></canvas>
<div class="mode-btn" onclick="toggleMode()">Change Mode</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<script>
let mode = 0; // 0-Normal, 1-Night, 2-Thermal
let video = document.getElementById('video');
let canvas = document.getElementById('hudCanvas');
let ctx = canvas.getContext('2d');

async function initCamera() {
  let stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
  video.srcObject = stream;
  video.onloadedmetadata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    runDetection();
  };
}

function toggleMode() {
  mode = (mode + 1) % 3;
}

async function runDetection() {
  const model = await cocoSsd.load();
  detectFrame(model);
}

function detectFrame(model) {
  model.detect(video).then(predictions => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Apply vision mode
    if (mode === 1) { ctx.filter = 'invert(1) brightness(1.5)'; }
    else if (mode === 2) { ctx.filter = 'hue-rotate(90deg) saturate(2)'; }
    else { ctx.filter = 'none'; }
    
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    ctx.filter = 'none';
    
    predictions.forEach(pred => {
      ctx.strokeStyle = 'rgba(0,255,255,0.8)';
      ctx.lineWidth = 2;
      ctx.strokeRect(pred.bbox[0], pred.bbox[1], pred.bbox[2], pred.bbox[3]);
      
      ctx.font = '16px Arial';
      ctx.fillStyle = 'cyan';
      ctx.fillText(`${pred.class} (${Math.round(pred.score*100)}%)`, pred.bbox[0], pred.bbox[1] > 10 ? pred.bbox[1]-5 : 10);
    });
    requestAnimationFrame(() => detectFrame(model));
  });
}

initCamera();
</script>
</body>
</html>
